/*!
 *  Licensed Materials - Property of IBM
 *  5725-I43 (C) Copyright IBM Corp. 2011, 2014. All Rights Reserved.
 *  US Government Users Restricted Rights - Use, duplication or
 *  disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
 *
 *  IBM Mobile Cloud Services, 
 *  IBMData Service JavaScript SDK v1.0.0.20140625-1347
 *
 */
(function(a,b){var c=!("function"!=typeof define||!define.amd),d="object"==typeof exports,e=function(){/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */
var a,c,e;return function(b){function d(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,c){return function(){return n.apply(b,v.call(arguments,0).concat([a,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(d(r,a)){var c=r[a];delete r[a],t[a]=!0,m.apply(b,c)}if(!d(q,a)&&!d(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,c,e,f){var h,k,l,m,n,s,u=[],v=typeof e;if(f=f||a,"undefined"===v||"function"===v){for(c=!c.length&&e.length?["require","exports","module"]:c,n=0;n<c.length;n+=1)if(m=o(c[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(d(q,k)||d(r,k)||d(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=e?e.apply(q[a],u):void 0,a&&(h&&h.exports!==b&&h.exports!==q[a]?q[a]=h.exports:l===b&&s||(q[a]=l))}else a&&(q[a]=e)},a=c=n=function(a,c,d,e,f){if("string"==typeof a)return p[a]?p[a](c):j(o(a,c).f);if(!a.splice){if(s=a,s.deps&&n(s.deps,s.callback),!c)return;c.splice?(a=c,c=d,d=null):a=b}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?m(b,a,c,d):setTimeout(function(){m(b,a,c,d)},4),n},n.config=function(a){return n(a)},a._defined=q,e=function(a,b,c){b.splice||(c=b,b=[]),d(q,a)||d(r,a)||(r[a]=[a,b,c])},e.amd={jQuery:!0}}(),e("almond",function(){}),e("ibm/mobile/service/_IBMData",["require","exports","module"],function(){var a=IBMLogger.getLogger(),b={VERSION:"1.0.0.20140625-1347",version:"1.0.0.20140625-1347",service:null,initializeService:function(b){if(!IBMBluemix&&!Q&&!IBMHttpRequest)throw new Error("IBMBluemix,Q,IBMHttpReqest are undefined.");return a.debug("IBMData: initializing version: "+this.getVersion()),this._init(b)},_init:function(){var a="_IBMData._init() not overwritten.";throw console.error(a),Error(a)},getVersion:function(){return this.version},getService:function(){if(!this.service)throw new IBMError("Data Service not initialized. Call initializeService()");return this.service}};return b}),e("ibm/mobile/utils",["require","exports","module"],function(){function a(a){var b="";for(prop in a){var c=a[prop];_.isUndefined(c)||_.isNull(c)||(b=b+prop+"="+c+"&")}return b.substring(0,b.length-1)}function b(a,b){return _.isObject(a)?(_.isArray(b)||(b=[b]),b.every(function(b){var c=a[b];return _.isNull(c)||_.isUndefined(c)?(console.warn("Object %o is missing field: %s",a,b),!1):!0})):!1}function c(a,b,c){var d=c||{};return _.isFunction(b)||(d=b,b=d.constructor,delete d.constructor),b.prototype=Object.create(a.prototype),Object.defineProperty(b.prototype,"constructor",{enumerable:!1,value:b}),_.extend(b.prototype,d),b}return{inherit:c,hasFields:b,toQueryString:a}}),e("ibm/mobile/service/data/error/IBMError",["require","exports","module","../../../utils"],function(a,b,c,d){function e(a){var b=a||{};_.isString(b)&&(b={message:a}),b.message=b.message||"";var c=new Error(b.message);c&&c.stack&&(b.stack=c.stack),Object.keys(b).forEach(function(a){this[a]=b[a]}.bind(this))}return e.inherit=function(a){function b(a){return function(){e.apply(this,_.toArray(arguments)),this.name=a}}var c,f=a||{};return _.isFunction(f)?(c=f,f=arguments[1]||{},f.constructor=c):c=f.constructor,c===Object?c=f.constructor=b(f.name||e.name):f.name||(f.name=c.name&&"Object"!==c.name&&"Function"!==c.name?c.name:e.name),d.inherit(e,c,f)},d.inherit(Error,e,{name:"IBMError",toString:function(){return this.name+" - "+this.message}})}),e("ibm/mobile/service/data/error/IBMDataError",["require","exports","module","./IBMError"],function(a,b,c,d){var e=d.inherit({constructor:function(){d.apply(this,_.toArray(arguments))}});return e}),e("ibm/mobile/service/data/request/_RequestMixin",["require","exports","module"],function(){var a={init:function(a){var b=IBMData.getService().requester,c={OP:b.OP,send:b.send.bind(b)};return _.extend(a,c),c}};return a}),e("ibm/mobile/service/data/IBMObject",["require","exports","module","../../utils","./error/IBMDataError","./request/_RequestMixin"],function(a,b,c,d,e,f){function g(a){this._meta={className:a,objectId:null,version:null,createdAt:null,modifiedAt:null,deleted:!1},this.attributes={},this.initialize(),f.init(this)}var h=function(a){return new e({name:"UnexpectedError",message:a})},i=function(a,b,c){return new e({message:"Unable to perform operation("+a+"): "+b,isDeleted:c===!0?!0:!1})},j=function(){return h("Invalid or null object returned from server.")};return g.createObjectFromServerVersion=function(a,b){var c,d=a.className,e=null;return b&&(e=b.getSpecializationFor(d)),e?(c=new e,c._updateWithServerVersion(a)):(c=new g(a.className),c._updateWithServerVersion(a)),c},_.extend(g.prototype,{_meta:{},attributes:{},constructor:g,initialize:function(){},save:function(){var a=this.OP.UPDATE;return this.getId()||(a=this.OP.CREATE),this._asyncOp(a)},del:function(){return this._asyncOp(this.OP.DELETE)},read:function(){if(!this.getId()){var a="Object must have id.";return this.isDeleted&&(a="Object has been deleted"),Q.reject(i(this.OP.READ,a,this.isDeleted()))}return this._asyncOp(this.OP.READ)},set:function(a,b){if(_.isObject(a)){var c=a;for(var d in c)this._set(d,c[d])}else this._set(a,b)},_set:function(a,b){if(a.indexOf(" ")>=0||a.indexOf(".")>=0)throw new TypeError("Field names can not contain spaces or periods");this.attributes[a]=b},get:function(a){return _.isString(a)?this.attributes[a]:this.attributes},getId:function(){return this.getMetadata("objectId")},getClassName:function(){return this.getMetadata("className")},getMetadata:function(a){return _.isString(a)?this._meta[a]:this._meta},isDeleted:function(){return this.getMetadata("deleted")},_asyncOp:function(a){return this.isDeleted()?Q.reject(a,"Object has been deleted.",!0):this._handlePromise(this.send(this,a).then(this._onOpSuccess(a)))},_handlePromise:function(a){var b=Q.defer();try{a.done(function(){b.resolve.apply(b,_.toArray(arguments))},function(){b.reject.apply(b,_.toArray(arguments))})}catch(c){b.reject(c)}return b.promise},_onOpSuccess:function(a){var b,c=this.OP;switch(a){case c.CREATE:b=this._onCreate;break;case c.UPDATE:b=this._onUpdate;break;case c.DELETE:b=this._onDelete;break;case c.READ:b=this._onRead;break;default:b=function(){return Q.reject(h("Unhandled op: "+a))}}return b.bind(this)},_onCreate:function(a){return this._updateWithServerVersion(a),Q.resolve(this)},_onRead:function(a){return this._updateWithServerVersion(a),Q.resolve(this)},_onUpdate:function(a){return this._updateWithServerVersion(a),Q.resolve(this)},_onDelete:function(){return _.keys(this._meta).forEach(function(a){this._meta[a]=null}.bind(this)),this._meta.deleted=!0,this.attributes={},Q.resolve(this)},_updateWithServerVersion:function(a){this._meta;if(!d.hasFields(a,["objectId","version","attributes"]))throw j();this.attributes=a.attributes,this._meta.version=a.version,this._meta.objectId=a.objectId,a.createdAt&&(this._meta.createdAt=a.createdAt),a.modifiedAt&&(this._meta.modifiedAt=a.modifiedAt)}}),g}),e("ibm/mobile/service/data/IBMQuery",["require","exports","module","./IBMObject","../../utils","./error/IBMDataError","./request/_RequestMixin"],function(a,b,c,d,e,f,g){function h(a,b){_.isEmpty(a)||(_.isString(a)?this.queryRequest.className=a:_.isObject(a)&&(this.queryRequest=a)),this.service=b,this._createObjectFromServerVersion=function(a){return d.createObjectFromServerVersion(a,b)},g.init(this)}return _.extend(h.prototype,{constructor:h,service:null,queryRequest:{query:{},options:{limit:0,offset:0}},find:function(a,b){var c=_.clone(this.queryRequest);return _.isObject(a)&&(c.criteria=a),_.isObject(b)&&(c.options=b),this._doQuery(c).then(function(a){var b=a.map(this._createObjectFromServerVersion.bind(this));return Q.resolve(b)}.bind(this))},findById:function(a){var b=this;return this._doQuery({objectId:a}).then(function(c){return c.length>1&&console.warn("Possible server error. More than one object returned with Id: "+a),1===c.length?Q.when(b._createObjectFromServerVersion(c[0])):Q.reject({reason:"Object with id "+a+" not found."})})},_doQuery:function(a){return this.send(a,this.OP.QUERY)}}),h}),e("ibm/mobile/service/data/request/_DataServiceRequest",["require","exports","module","../error/IBMError"],function(){var a={invalidOp:"Invalid operation provided: ",unimplementedRequest:"Request hasn't been implemented"},b={OP:{UPDATE:"UPDATE",READ:"READ",DELETE:"DELETE",CREATE:"CREATE",QUERY:"QUERY"},send:function(){return console.error("Request send method not implemented"),Q.reject(a.unimplementedRequest)}};return b}),e("ibm/mobile/service/data/request/RestRequest",["require","exports","module","../../../utils","./_DataServiceRequest","../error/IBMError"],function(a,b,c,d,e,f){function g(a,b){this.serviceUrl=a,this.restUrl=this.serviceUrl.append("rest").append("v1").append("apps").append(b).toString(),this.bjax=IBMHttpRequest}var h=5e3,i=f.inherit({constructor:function(a,b,c){var d={message:a};b&&(d.status=b),c&&(d.data=c),f.call(this,d)}});return _.extend(g.prototype,e,{bjax:null,send:function(a,b){if(!this._isValidObject(a,b))return Q.reject(new i("Object is invalid for given operation"));switch(b){case this.OP.CREATE:return this._createRequest(a);case this.OP.UPDATE:return this._updateRequest(a);case this.OP.DELETE:return this._deleteRequest(a);case this.OP.READ:return this._readRequest(a);case this.OP.QUERY:return this._queryRequest(a);default:return Q.reject(new i("Invalid operation provided: "+b))}},setExpressReq:function(a){this.expressReq=a},_meetsCriteria:function(a,b){b=b||{};var c=a.attributes||{};return Object.keys(b).every(function(a){return c[a]===b[a]})},_onRequestDone:function(a,b){function c(b){console.dir(b),b?"success"===b.status?a.resolve(b):a.reject(new i("Unhandled status",b.status,b)):a.reject(new i("No data returned"))}function d(b){a.reject(new i("Unexpected error when communicating with server",b))}b=b===!0||!1;return b?d:c},_request:function(a){var b=Q.defer(),c=this.restUrl+"/"+a.endpoint,d={url:c,timeout:h,method:a.method,handleAs:"json"};return a.payload&&(d.data=JSON.stringify(a.payload),d.contentType="json"),this.bjax(d,this.expressReq).then(this._onRequestDone(b).bind(this),this._onRequestDone(b,!0).bind(this)),b.promise},_createRequest:function(a){var b={payload:[a.get()],method:"POST",endpoint:"injections?classname="+a.getClassName()};return this._request(b).then(this._getObjectFromResponse)},_getObjectFromResponse:function(a){var b=a&&a.object;return _.isArray(b)&&(b=a.object[0]),b?Q.resolve(b):Q.reject(new i("Response is missing created object",null,a))},_updateRequest:function(a){var b=a.getMetadata(),c=a.getId(),d={payload:{objectId:c,version:b.version,updates:a.get()},method:"PUT",endpoint:"objects/"+c};return this._request(d).then(this._getObjectFromResponse)},_deleteRequest:function(a){var b=a.getId(),c={method:"DELETE",endpoint:"objects/"+b};return this._request(c)},_readRequest:function(a){var b=a.getId(),c={method:"GET",endpoint:"objects/"+b};return this._request(c).then(this._getObjectFromResponse)},_queryRequest:function(a){var b={endpoint:"objects",method:"GET"};if(a.objectId)b.endpoint+="/"+a.objectId;else{var c={classname:a.className};b.endpoint+="?"+d.toQueryString(c)}return this._request(b).then(function(b){var c=b.object;return a.criteria&&(c=b.object.filter(function(b){return this._meetsCriteria(b,a.criteria)&&this._isValidServerVersionObject(b)}.bind(this))),Q.resolve(c)}.bind(this))},_isValidObject:function(a,b){if(b==this.OP.QUERY)return!0;var c=a.getMetadata(),e=["className"];return b==this.OP.UPDATE&&e.concat(["objectId","version"]),b==this.OP.DELETE&&e.push("objectId"),d.hasFields(c,e)},_isValidServerVersionObject:function(a){return d.hasFields(a,["objectId","className","version","attributes"])}}),g}),e("ibm/mobile/service/data/IBMDataService",["require","exports","module","./IBMObject","./IBMQuery","./request/_DataServiceRequest","./request/RestRequest"],function(a,b,c,d,e){function f(a){this.requester=a,this.Object=g(this),this.Query=h(this)}function g(a){return{service:a,extend:function(a,b){function c(){d.call(this,a)}return c.prototype=new d,_.extend(c.prototype,b,{constructor:c}),this.service.specializations[a]=c,c},ofType:function(a,b){var c=new d(a);return _.isObject(b)&&c.set(b),c},withId:function(a){return new e({},this.service).findById(a)}}}function h(a){return{service:a,forAll:function(){return new e(void 0,this.service)},ofType:function(a){return new e(a,this.service)},forObjectId:function(a){return new e({objectId:a},this.service)}}}return f.prototype={requester:null,specializations:{},getSpecializationFor:function(a){return this.specializations[a]},Object:null,Query:null},f}),e("ibm/mobile/service/IBMData",["require","exports","module","./_IBMData","./data/IBMDataService","./data/request/RestRequest"],function(a,c,e,f,g,h){var i=function(a,b,c,e,f,g){var h=_.extend(e,{_init:function(a){var c=new IBMUriBuilder(IBMBluemix.config.getBaaSURL()).append("data");appId=IBMBluemix.config.getApplicationId(),isNode="boolean"==typeof d?d:"object"==typeof b;var e=new g(c,appId),h=new f(e);return isNode&&_.isObject(a)&&e.setExpressReq(a),this.service=h,this.requester=e,this.service}});return h}.call(this,a,c,e,f,g,h),j=b.IBMData;return b.IBMData=i,i.noConflict=function(){return b.IBMData=j,i},i}),c("ibm/mobile/service/IBMData")};return c?define(e):d?module.exports=e():e()}).call(this,"object"==typeof exports?global:window,"object"==typeof exports?global:window);